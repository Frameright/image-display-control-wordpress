/*! (c) Andrea Giammarchi @webreflection ISC */
!function(){var e=function(e,t){var i=function(e){for(var t=0,i=e.length;t<i;t++)n(e[t])},n=function(e){var t=e.target,i=e.attributeName,n=e.oldValue;t.attributeChangedCallback(i,n,t.getAttribute(i))};return function(s,r){var o=s.constructor.observedAttributes;return o&&e(r).then((function(){new t(i).observe(s,{attributes:!0,attributeOldValue:!0,attributeFilter:o});for(var e=0,r=o.length;e<r;e++)s.hasAttribute(o[e])&&n({target:s,attributeName:o[e],oldValue:null})})),s}};function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function i(e,i){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,i){if(e){if("string"==typeof e)return t(e,i);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,i):void 0}}(e))||i&&e&&"number"==typeof e.length){n&&(e=n);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw o}}}}
/*! (c) Andrea Giammarchi - ISC */var n=!0,s=!1,r="querySelectorAll",o="querySelectorAll",a=self,l=a.document,h=a.Element,g=a.MutationObserver,c=a.Set,d=a.WeakMap,u=function(e){return o in e},f=[].filter,v=function(e){var t=new d,a=function(i,n){var s;if(n)for(var r,o=function(e){return e.matches||e.webkitMatchesSelector||e.msMatchesSelector}(i),a=0,l=p.length;a<l;a++)o.call(i,r=p[a])&&(t.has(i)||t.set(i,new c),(s=t.get(i)).has(r)||(s.add(r),e.handle(i,n,r)));else t.has(i)&&(s=t.get(i),t.delete(i),s.forEach((function(t){e.handle(i,n,t)})))},v=function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=0,n=e.length;i<n;i++)a(e[i],t)},p=e.query,b=e.root||l,_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:MutationObserver,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:["*"],l=function t(s,o,a,l,h,g){var c,d=i(s);try{for(d.s();!(c=d.n()).done;){var u=c.value;(g||r in u)&&(h?a.has(u)||(a.add(u),l.delete(u),e(u,h)):l.has(u)||(l.add(u),a.delete(u),e(u,h)),g||t(u[r](o),o,a,l,h,n))}}catch(e){d.e(e)}finally{d.f()}},h=new o((function(e){if(a.length){var t,r=a.join(","),o=new Set,h=new Set,g=i(e);try{for(g.s();!(t=g.n()).done;){var c=t.value,d=c.addedNodes,u=c.removedNodes;l(u,r,o,h,s,s),l(d,r,o,h,n,s)}}catch(e){g.e(e)}finally{g.f()}}})),g=h.observe;return(h.observe=function(e){return g.call(h,e,{subtree:n,childList:n})})(t),h}(a,b,g,p),m=h.prototype.attachShadow;return m&&(h.prototype.attachShadow=function(e){var t=m.call(this,e);return _.observe(t),t}),p.length&&v(b[o](p)),{drop:function(e){for(var i=0,n=e.length;i<n;i++)t.delete(e[i])},flush:function(){for(var e=_.takeRecords(),t=0,i=e.length;t<i;t++)v(f.call(e[t].removedNodes,u),!1),v(f.call(e[t].addedNodes,u),!0)},observer:_,parse:v}},p=self,b=p.document,_=p.Map,m=p.MutationObserver,w=p.Object,R=p.Set,y=p.WeakMap,z=p.Element,O=p.HTMLElement,S=p.Node,x=p.Error,C=p.TypeError,I=p.Reflect,E=w.defineProperty,T=w.keys,k=w.getOwnPropertyNames,D=w.setPrototypeOf,P=!self.customElements,A=function(e){for(var t=T(e),i=[],n=new R,s=t.length,r=0;r<s;r++){i[r]=e[t[r]];try{delete e[t[r]]}catch(e){n.add(r)}}return function(){for(var r=0;r<s;r++)n.has(r)||(e[t[r]]=i[r])}};if(P){var B=function(){var e=this.constructor;if(!F.has(e))throw new C("Illegal constructor");var t=F.get(e);if(G)return q(G,t);var i=L.call(b,t);return q(D(i,e.prototype),t)},L=b.createElement,F=new _,N=new _,M=new _,$=new _,W=[],H=v({query:W,handle:function(e,t,i){var n=M.get(i);if(t&&!n.isPrototypeOf(e)){var s=A(e);G=D(e,n);try{new n.constructor}finally{G=null,s()}}var r="".concat(t?"":"dis","connectedCallback");r in n&&e[r]()}}).parse,G=null,U=function(e){if(!N.has(e)){var t,i=new Promise((function(e){t=e}));N.set(e,{$:i,_:t})}return N.get(e).$},q=e(U,m);self.customElements={define:function(e,t){if($.has(e))throw new x('the name "'.concat(e,'" has already been used with this registry'));F.set(t,e),M.set(e,t.prototype),$.set(e,t),W.push(e),U(e).then((function(){H(b.querySelectorAll(e))})),N.get(e)._(t)},get:function(e){return $.get(e)},whenDefined:U},E(B.prototype=O.prototype,"constructor",{value:B}),self.HTMLElement=B,b.createElement=function(e,t){var i=t&&t.is,n=i?$.get(i):$.get(e);return n?new n:L.call(b,e)},"isConnected"in S.prototype||E(S.prototype,"isConnected",{configurable:!0,get:function(){return!(this.ownerDocument.compareDocumentPosition(this)&this.DOCUMENT_POSITION_DISCONNECTED)}})}else if(P=!self.customElements.get("extends-br"))try{var V=function e(){return self.Reflect.construct(HTMLBRElement,[],e)};V.prototype=HTMLLIElement.prototype;var j="extends-br";self.customElements.define("extends-br",V,{extends:"br"}),P=b.createElement("br",{is:j}).outerHTML.indexOf(j)<0;var X=self.customElements,Z=X.get,J=X.whenDefined;self.customElements.whenDefined=function(e){var t=this;return J.call(this,e).then((function(i){return i||Z.call(t,e)}))}}catch(e){}if(P){var Y=function(e){var t=re.get(e);fe(t.querySelectorAll(this),e.isConnected)},K=self.customElements,Q=b.createElement,ee=K.define,te=K.get,ie=K.upgrade,ne=I||{construct:function(e){return e.call(this)}},se=ne.construct,re=new y,oe=new R,ae=new _,le=new _,he=new _,ge=new _,ce=[],de=[],ue=function(e){return ge.get(e)||te.call(K,e)},fe=v({query:de,handle:function(e,t,i){var n=he.get(i);if(t&&!n.isPrototypeOf(e)){var s=A(e);me=D(e,n);try{new n.constructor}finally{me=null,s()}}var r="".concat(t?"":"dis","connectedCallback");r in n&&e[r]()}}).parse,ve=v({query:ce,handle:function(e,t){re.has(e)&&(t?oe.add(e):oe.delete(e),de.length&&Y.call(de,e))}}).parse,pe=z.prototype.attachShadow;pe&&(z.prototype.attachShadow=function(e){var t=pe.call(this,e);return re.set(this,t),t});var be=function(e){if(!le.has(e)){var t,i=new Promise((function(e){t=e}));le.set(e,{$:i,_:t})}return le.get(e).$},_e=e(be,m),me=null;k(self).filter((function(e){return/^HTML.*Element$/.test(e)})).forEach((function(e){var t=self[e];function i(){var e=this.constructor;if(!ae.has(e))throw new C("Illegal constructor");var i=ae.get(e),n=i.is,s=i.tag;if(n){if(me)return _e(me,n);var r=Q.call(b,s);return r.setAttribute("is",n),_e(D(r,e.prototype),n)}return se.call(this,t,[],e)}E(i.prototype=t.prototype,"constructor",{value:i}),E(self,e,{value:i})})),b.createElement=function(e,t){var i=t&&t.is;if(i){var n=ge.get(i);if(n&&ae.get(n).tag===e)return new n}var s=Q.call(b,e);return i&&s.setAttribute("is",i),s},K.get=ue,K.whenDefined=be,K.upgrade=function(e){var t=e.getAttribute("is");if(t){var i=ge.get(t);if(i)return void _e(D(e,i.prototype),t)}ie.call(K,e)},K.define=function(e,t,i){if(ue(e))throw new x("'".concat(e,"' has already been defined as a custom element"));var n,s=i&&i.extends;ae.set(t,s?{is:e,tag:s}:{is:"",tag:e}),s?(n="".concat(s,'[is="').concat(e,'"]'),he.set(n,t.prototype),ge.set(e,t),de.push(n)):(ee.apply(K,arguments),ce.push(n=e)),be(e).then((function(){s?(fe(b.querySelectorAll(n)),oe.forEach(Y,[n])):ve(b.querySelectorAll(n))})),le.get(e)._(t)}}}();class Logger{constructor(e,t){this._id=e,this._level=Logger._toValue(t)}setLevel(e){this._level=Logger._toValue(e)}setId(e){this._id=e}debug(e){this._level>=Logger._DEBUG&&console.log(this._consoleText(e))}warn(e){this._level>=Logger._WARN&&console.warn(this._consoleText(e))}error(e){this._level>=Logger._ERROR&&console.error(this._consoleText(e))}static _toValue(e){const t=(e||"").toLowerCase();return"debug"===t||"trace"===t||"notice"===t?Logger._DEBUG:"info"===t?Logger._INFO:t.startsWith("warn")?Logger._WARN:t.startsWith("err")?Logger._ERROR:"fatal"===t?Logger._FATAL:Logger._OFF}_consoleText(e){return this._id?`[idc:${this._id}] ${e}`:`[idc] ${e}`}}Logger._OFF=0,Logger._FATAL=1,Logger._ERROR=2,Logger._WARN=3,Logger._INFO=4,Logger._DEBUG=5;class PositionInPixels{constructor(e,t){this.x=e,this.y=t}getRelativeCoord(e){return e.isUnknown()?new PositionInRelativeCoord:new PositionInRelativeCoord(this.x/e.getSafeWidth(),this.y/e.getSafeHeight())}toString(){return`{x=${this.x.toFixed(3)}px, y=${this.y.toFixed(3)}px}`}}class PositionInRelativeCoord{constructor(e,t){this._x=Math.max(Math.min(null!=e?e:0,1),0),this._y=Math.max(Math.min(null!=t?t:0,1),0)}getPositionInPixels(e){let t=0,i=0;return e.isUnknown()||(t=e.getWidth(),i=e.getHeight()),new PositionInPixels(this._x*t,this._y*i)}toString(){return`{x=${this._x.toFixed(3)}, y=${this._y.toFixed(3)}}`}}class SizeInRelativeCoord{constructor(e,t){this._width=Math.max(Math.min(null!=e?e:0,1),0),this._height=Math.max(Math.min(null!=t?t:0,1),0)}getSizeInPixels(e){let t=0,i=0;return e.isUnknown()||(t=e.getWidth(),i=e.getHeight()),new SizeInPixels(this._width*t,this._height*i)}toString(){return`{width=${this._width.toFixed(3)}, height=${this._height.toFixed(3)}}`}}class SizeInPixels{constructor(e,t){this._unknown=!0,this._width=0,this._height=0,null!=e&&null!=t&&(this._width=Math.max(e,0),this._height=Math.max(t,0),this._unknown=!1)}getWidth(){return this._width}getHeight(){return this._height}getSafeWidth(){return Math.max(this._width,1)}getSafeHeight(){return Math.max(this._height,1)}getSafeRatio(){return this.getSafeWidth()/this.getSafeHeight()}getScaled(e){if(this.isUnknown())return new SizeInPixels;const t=this._width*e,i=this._height*e;return new SizeInPixels(t,i)}isUnknown(){return this._unknown}setIfDifferent(e){return!this.equals(e)&&(this._unknown=e.isUnknown(),this._width=e.getWidth(),this._height=e.getHeight(),!0)}ratioDiffFactor(e){const t=this.getSafeRatio(),i=e.getSafeRatio();return t>=i?t/i:i/t}getRelativeCoord(e){return e.isUnknown()?new SizeInRelativeCoord:new SizeInRelativeCoord(this._width/e.getSafeWidth(),this._height/e.getSafeHeight())}toString(){return`{width=${this._width.toFixed(3)}px, height=${this._height.toFixed(3)}px}`}equals(e){return this._width===e.getWidth()&&this._height===e.getHeight()}}class RectangleImageRegion{static getTransformedImageSize(e,t){return e.getScaled(t.factor)}constructor(e,t,i){this.id=null!=e?e:"",this.position=null!=t?t:new PositionInRelativeCoord,this.size=null!=i?i:new SizeInRelativeCoord,this._unknown=!t||!i}setFields(e,t){var i,n;const s=e.shape?e.shape.toLowerCase():"rectangle";if("rectangle"!==s)return t.debug(`Region ${e.id} has unknown shape ${s}, skipping.`),void(this._unknown=!0);let r=null===(i=e.unit)||void 0===i?void 0:i.toLowerCase();if(r||(e.imageWidth&&e.imageHeight?r="pixel":e.imageWidth||e.imageHeight||(r="relative")),"relative"!==r&&"pixel"!==r)return t.debug(`Region ${e.id} has unknown unit ${r}, skipping.`),void(this._unknown=!0);let o=new SizeInPixels;if("pixel"===r){if(null==e.imageWidth||null==e.imageHeight)return t.warn(`Region ${e.id} has missing imageWidth or imageHeight, skipping.`),void(this._unknown=!0);o=new SizeInPixels(parseFloat(`${e.imageWidth}`),parseFloat(`${e.imageHeight}`))}if(null==e.x||null==e.y||null==e.width||null==e.height)return t.warn(`Region ${e.id} has missing x, y, width or height, skipping.`),void(this._unknown=!0);const a=parseFloat(`${e.x}`),l=parseFloat(`${e.y}`),h=parseFloat(`${e.width}`),g=parseFloat(`${e.height}`);return Number.isNaN(a)||Number.isNaN(l)||Number.isNaN(h)||Number.isNaN(g)?(t.warn(`Region ${e.id} has non-numeric x, y, width or height, skipping.`),void(this._unknown=!0)):a<0||l<0||h<=0||g<=0?(t.warn(`Region ${e.id} has negative/zero x, y, width or height, skipping.`),void(this._unknown=!0)):("relative"===r?(this.position=new PositionInRelativeCoord(a,l),this.size=new SizeInRelativeCoord(h,g)):(this.position=new PositionInPixels(a,l).getRelativeCoord(o),this.size=new SizeInPixels(h,g).getRelativeCoord(o)),this.id=null!==(n=e.id)&&void 0!==n?n:window.crypto.randomUUID(),void(this._unknown=!1))}isUnknown(){return this._unknown}getTransformation(e,t,i){const n=this.position.getPositionInPixels(t),s=this.size.getSizeInPixels(t),r=s.getSafeWidth(),o=s.getSafeHeight(),a=e.getSafeWidth(),l=e.getSafeHeight(),h=t.getWidth(),g=t.getHeight(),c=h-r-n.x,d=g-o-n.y;let u=0,f=0,v=1;if(e.getSafeRatio()<s.getSafeRatio()){v=a/r,f=(l/v-o)/2;(f-n.y>0||f-d>0)&&(f=Math.min(n.y,d),v=l/(2*f+o),u=(a/v-r)/2)}else{v=l/o,u=(a/v-r)/2;(u-n.x>0||u-c>0)&&(u=Math.min(n.x,c),v=a/(2*u+r),f=(l/v-o)/2)}const p=new PositionInPixels(n.x-u,n.y-f);return{origin:p,factor:v,insetClipFromTopLeft:new SizeInPixels(p.x,p.y),insetClipFromBottomRight:new SizeInPixels(c-u+i.getWidth(),d-f+i.getHeight())}}getBoundingBox(e,t,i){const n=new PositionInPixels(-i.origin.x*i.factor,-i.origin.y*i.factor),s=RectangleImageRegion.getTransformedImageSize(t,i),r=this.position.getPositionInPixels(s);return{position:new PositionInPixels(r.x+n.x,r.y+n.y),size:this.size.getSizeInPixels(s)}}}class ImageDisplayControl extends HTMLImageElement{constructor(){super(...arguments),this._rectangleImageRegions=[],this._sizeObserver=null,this._elementSize=new SizeInPixels,this._fittedImageSize=new SizeInPixels,this._fittedImageBottomRightMargin=new SizeInPixels,this._parentElement=null,this._parentCssContainToRestore=null,this._parentCssOverflowToRestore=null,this._sizesAttributeToRestore=null,this._sizesAttributeDebounceTimer=null,this._sizesAttributeLastSet=null,this._cssBorderToRestore=null,this._cssPaddingToRestore=null,this._logger=new Logger(this.id,this.dataset.loglevel),this._browserFeatures={cssInset:!1,resizeObserver:!1,cssContain:!1},this._debugRegionOverlayContainer=null,this._debugRegionOverlays=new Map,this._debugRegionOverlayStyles=["5px solid rgba(240, 69, 141, 0.7)","5px solid rgba(127, 15, 130, 0.7)","5px solid rgba(48, 0, 150, 0.7)"]}static get observedAttributes(){return["id","src","srcset","data-loglevel","data-disabled","data-image-regions","data-image-region-id","data-avoid-no-region","data-debug-draw-regions","data-css-contain-fallback"]}connectedCallback(){this._logger.debug("Connected"),this._registerImageLoadedLateCallback(),this._behaviorChanged()}disconnectedCallback(){this._logger.debug("Disconnected"),this._removeDebugRegionOverlays(),this._unregisterImageLoadedLateCallback(),this._restoreOriginalParentCssContainment()}attributeChangedCallback(e){switch(e){case"id":this._logger.setId(this.id);break;case"src":case"srcset":this._isDisabled()||(this._registerImageLoadedLateCallback(),this._populateFittedImageSize(),this._panAndZoomToBestRegion());break;case"data-loglevel":this._logger.setLevel(this.dataset.loglevel);break;case"data-disabled":case"data-debug-draw-regions":case"data-css-contain-fallback":this._behaviorChanged();break;case"data-image-regions":this._populateRectangleImageRegions(),this._isDisabled()||(this._resetDebugRegionOverlays(),this._panAndZoomToBestRegion());break;case"data-image-region-id":case"data-avoid-no-region":this._isDisabled()||this._panAndZoomToBestRegion();break;default:this._logger.warn(`Unexpected attribute mutation: ${e}`)}}_getInternal(expr){return eval(expr)}_behaviorChanged(){this._populateBrowserFeatures(),this._isDisabled()?(this._unregisterImageLoadedLateCallback(),this._logger.debug("Disabled"),this._sizeObserver&&(this._sizeObserver.unobserve(this),this._sizeObserver=null),this._setDebounceSizesAttribute(),this._restoreOriginalBorderAndPadding(),this._removeDebugRegionOverlays(),this._setCssToMiddleCropOriginalImage(),this._restoreOriginalParentCssContainment()):(this._logger.debug("Enabled"),this._adaptParentCssContainment(),this._resetDebugRegionOverlays(),this._panAndZoomToBestRegion(),this._sizeObserver||(this._sizeObserver=new ResizeObserver(this._resizeCallback.bind(this)),this._sizeObserver.observe(this)))}_resizeCallback(e){if(this._isDisabled())return void this._logger.warn("Component disabled, spurious call to _resizeCallback()");const t=e.pop();if(!t)return void this._logger.warn("No ResizeObserverEntry, spurious call to _resizeCallback()");if(t.target!==this)return void this._logger.warn("Unexpected ResizeObserverEntry target");let i=new SizeInPixels;i=t.contentBoxSize?new SizeInPixels(t.contentBoxSize[0].inlineSize,t.contentBoxSize[0].blockSize):new SizeInPixels(t.contentRect.width,t.contentRect.height);this._elementSize.setIfDifferent(i)&&(this._logger.debug(`Element size: ${this._elementSize}`),this._populateFittedImageSize(),this._panAndZoomToBestRegion())}_imageLoadedLateCallback(){this._unregisterImageLoadedLateCallback(),this._logger.debug("Image loaded late"),this._populateFittedImageSize(),this._panAndZoomToBestRegion()}_registerImageLoadedLateCallback(){this._logger.debug('Registering "Image loaded late" callback...'),this.addEventListener("load",this._imageLoadedLateCallback)}_unregisterImageLoadedLateCallback(){this._logger.debug('Unregistering "Image loaded late" callback...'),this.removeEventListener("load",this._imageLoadedLateCallback)}_populateRectangleImageRegions(){this._logger.debug("Populating rectangle image regions..."),this._rectangleImageRegions=[];let e=[],t=!1;try{e=JSON.parse(this.dataset.imageRegions||"[]")}catch(e){t=!0}t||(t=!Array.isArray(e)),t&&(this._logger.warn("Invalid 'data-image-regions' attribute"),e=[]),e.forEach((e=>{const t=new RectangleImageRegion;t.setFields(e,this._logger),t.isUnknown()||(this._logger.debug(`Rectangle region found: id=${t.id}, position=${t.position}, size=${t.size}`),this._rectangleImageRegions.push(t))})),this._rectangleImageRegions.length||this._logger.debug("No rectangle image region found")}_populateFittedImageSize(){if(this.naturalWidth<=0&&this.naturalHeight<=0)return void this._logger.debug("Natural image size unknown, deferring.");const e=new SizeInPixels(this.naturalWidth,this.naturalHeight);let t=1;t=this._elementSize.getSafeRatio()<e.getSafeRatio()?this._elementSize.getSafeWidth()/e.getSafeWidth():this._elementSize.getSafeHeight()/e.getSafeHeight(),this._fittedImageSize=new SizeInPixels(this.naturalWidth*t,this.naturalHeight*t),this._fittedImageBottomRightMargin=new SizeInPixels(this._elementSize.getWidth()-this._fittedImageSize.getWidth(),this._elementSize.getHeight()-this._fittedImageSize.getHeight()),this._logger.debug(`Fitted image size: ${this._fittedImageSize}`),this._logger.debug(`Fitted image margin: ${this._fittedImageBottomRightMargin}`)}_panAndZoomToBestRegion(){if(this._logger.debug("Panning and zooming to best region..."),this._fittedImageSize.isUnknown())return void this._logger.debug("Fitted image size unknown, deferring.");let e=null;if(this.dataset.imageRegionId&&(e=this.dataset.imageRegionId===ImageDisplayControl._ORIGINAL_IMAGE_REGION.id?ImageDisplayControl._ORIGINAL_IMAGE_REGION:this._rectangleImageRegions.find((e=>e.id===this.dataset.imageRegionId))),e||(e=this._findBestRegion()),ImageDisplayControl._ORIGINAL_IMAGE_REGION.id!==e.id||this._debugRegionOverlayContainer){null===this._cssBorderToRestore&&(this._cssBorderToRestore=this.style.border,this.style.border="none"),null===this._cssPaddingToRestore&&(this._cssPaddingToRestore=this.style.padding,this.style.padding="0");const t=e.getTransformation(this._elementSize,this._fittedImageSize,this._fittedImageBottomRightMargin);if(this._setCssToPanAndZoomToRegion(t),this._debugRegionOverlayContainer&&this._drawDebugRegionOverlays(t),this.srcset.length>0&&this.sizes.length>0){const e=RectangleImageRegion.getTransformedImageSize(this._fittedImageSize,t).getWidth();this._setDebounceSizesAttribute(e)}}else this._setDebounceSizesAttribute(),this._restoreOriginalBorderAndPadding(),this._setCssToMiddleCropOriginalImage()}_findBestRegion(){let e=ImageDisplayControl._ORIGINAL_IMAGE_REGION,t=this._elementSize.ratioDiffFactor(this._fittedImageSize);return this._logger.debug(`Element ratio: ${this._elementSize.getSafeRatio().toFixed(3)}`),this._logger.debug(`Original image ratio: ${this._fittedImageSize.getSafeRatio().toFixed(3)}`),this.dataset.avoidNoRegion&&"off"===this.dataset.avoidNoRegion||(t=999),t>1.1&&this._rectangleImageRegions.forEach((i=>{const n=i.size.getSizeInPixels(this._fittedImageSize);this._logger.debug(`${i.id} region ratio: ${n.getSafeRatio().toFixed(3)}`);const s=this._elementSize.ratioDiffFactor(n);s<t&&(t=s,e=i)})),this._logger.debug(`Selected region: ${e.id}`),e}_adaptParentCssContainment(){const e=this._currentCssContainmentStrategy();"none"!==e?(this._parentElement=this.parentElement,this._parentElement&&("contain"===e?("paint"!==this._parentElement.style.contain&&"layout"!==this._parentElement.style.contain&&"content"!==this._parentElement.style.contain&&(null===this._parentCssContainToRestore&&(this._parentCssContainToRestore=this._parentElement.style.contain),this._parentElement.style.contain="paint"),this._restoreOriginalParentCssOverflow()):"overflow"===e&&("hidden"!==this._parentElement.style.overflow&&"clip"!==this._parentElement.style.overflow&&(null===this._parentCssOverflowToRestore&&(this._parentCssOverflowToRestore=this._parentElement.style.overflow),this._parentElement.style.overflow="hidden"),this._restoreOriginalParentCssContain()))):this._restoreOriginalParentCssContainment()}_restoreOriginalParentCssContainment(){this._restoreOriginalParentCssContain(),this._restoreOriginalParentCssOverflow()}_restoreOriginalParentCssContain(){this._parentElement&&null!==this._parentCssContainToRestore&&(this._parentElement.style.contain=this._parentCssContainToRestore,this._parentCssContainToRestore=null)}_restoreOriginalParentCssOverflow(){this._parentElement&&null!==this._parentCssOverflowToRestore&&(this._parentElement.style.overflow=this._parentCssOverflowToRestore,this._parentCssOverflowToRestore=null)}_setDebounceSizesAttribute(e){null!==this._sizesAttributeDebounceTimer&&clearTimeout(this._sizesAttributeDebounceTimer);this._sizesAttributeDebounceTimer=void 0!==e?window.setTimeout((()=>{if(this._sizesAttributeDebounceTimer=null,null===this._sizesAttributeToRestore&&(this._sizesAttributeToRestore=this.sizes),null===this._sizesAttributeLastSet||this._sizesAttributeLastSet<e){this._unregisterImageLoadedLateCallback();const t=`${Math.ceil(e)}px`;this._logger.debug(`Increasing sizes= to ${t}`),this.sizes=t,this._sizesAttributeLastSet=e}}),200):window.setTimeout((()=>{this._sizesAttributeDebounceTimer=null,null!==this._sizesAttributeToRestore&&(this._unregisterImageLoadedLateCallback(),this._logger.debug(`Resetting sizes= to ${this._sizesAttributeToRestore}`),this.sizes=this._sizesAttributeToRestore,this._sizesAttributeToRestore=null),this._sizesAttributeLastSet=null}),200)}_restoreOriginalBorderAndPadding(){null!==this._cssBorderToRestore&&(this.style.border=this._cssBorderToRestore,this._cssBorderToRestore=null),null!==this._cssPaddingToRestore&&(this.style.padding=this._cssPaddingToRestore,this._cssPaddingToRestore=null)}_setCssToMiddleCropOriginalImage(){this.style.objectFit="cover",this.style.objectPosition="center",this.style.transformOrigin="0 0",this.style.transform="none",this.style.clipPath="none"}_setCssToPanAndZoomToRegion(e){this.style.objectFit="contain",this.style.objectPosition="top left",this.style.transformOrigin=`${e.origin.x.toFixed(3)}px ${e.origin.y.toFixed(3)}px`,this.style.transform=`translate(${-e.origin.x.toFixed(3)}px, ${-e.origin.y.toFixed(3)}px) scale(${e.factor.toFixed(3)})`,this.style.clipPath=`inset(${e.insetClipFromTopLeft.getHeight()}px ${e.insetClipFromBottomRight.getWidth()}px ${e.insetClipFromBottomRight.getHeight()}px ${e.insetClipFromTopLeft.getWidth()}px)`}_resetDebugRegionOverlays(){"on"===(this.dataset.debugDrawRegions||"off")?this._recreateEmptyDebugRegionOverlays():this._removeDebugRegionOverlays()}_recreateEmptyDebugRegionOverlays(){var e;this._removeDebugRegionOverlays(),this._debugRegionOverlayContainer=document.createElement("div"),this._debugRegionOverlayContainer.style.position="absolute",null===(e=this._parentElement)||void 0===e||e.insertBefore(this._debugRegionOverlayContainer,this)}_removeDebugRegionOverlays(){var e;if(this._debugRegionOverlayContainer){try{null===(e=this._parentElement)||void 0===e||e.removeChild(this._debugRegionOverlayContainer)}catch(e){}this._debugRegionOverlayContainer=null}this._debugRegionOverlays.clear()}_drawDebugRegionOverlays(e){this._rectangleImageRegions.forEach((t=>{this._drawDebugRegionOverlay(t,e)}))}_drawDebugRegionOverlay(e,t){var i;let n=this._debugRegionOverlays.get(e.id);n||(n=document.createElement("div"),n.style.position="absolute",n.style.boxSizing="border-box",n.style.border=this._pickNextOvelayStyle(),n.style.zIndex="999",null===(i=this._debugRegionOverlayContainer)||void 0===i||i.appendChild(n),this._debugRegionOverlays.set(e.id,n));const s=e.getBoundingBox(this._elementSize,this._fittedImageSize,t);n.style.left=`${s.position.x}px`,n.style.top=`${s.position.y}px`,n.style.width=`${s.size.getWidth()}px`,n.style.height=`${s.size.getHeight()}px`}_pickNextOvelayStyle(){const e=this._debugRegionOverlayStyles.shift()||"5px solid rgba(255, 0, 0, 0.7)";return this._debugRegionOverlayStyles.push(e),e}_populateBrowserFeatures(){const e=CSS.supports("clip-path: inset(5px)");e||this._logger.error("CSS `clip-path: inset()` is not supported. Disabling the web component");const t="undefined"!=typeof ResizeObserver;t||this._logger.error("ResizeObserver is not supported. Disabling the web component. Consider using a polyfill like  https://github.com/juggle/resize-observer");const i=CSS.supports("contain: paint");i||this.dataset.cssContainFallback||this._logger.warn("CSS containment is not supported. Consider using the `css-contain-fallback=` attribute"),this._browserFeatures={cssInset:e,resizeObserver:t,cssContain:i}}_cssContainFallbackStrategy(){return"disable-containment"===this.dataset.cssContainFallback||"overflow-hidden"===this.dataset.cssContainFallback||"force"===this.dataset.cssContainFallback?this.dataset.cssContainFallback:"disable-component"}_isDisabled(){return"all"===this.dataset.disabled||!this._browserFeatures.cssInset||!this._browserFeatures.resizeObserver||this._isCssContainUnsupportedOrDisabled()&&"disable-component"===this._cssContainFallbackStrategy()}_isCssContainUnsupportedOrDisabled(){return!this._browserFeatures.cssContain||"css-contain"===this.dataset.disabled}_currentCssContainmentStrategy(){if(this._isDisabled())return"none";if(!this._isCssContainUnsupportedOrDisabled())return"contain";const e=this._cssContainFallbackStrategy();return"overflow-hidden"===e?"overflow":"disable-containment"===e?"none":"contain"}}ImageDisplayControl._ORIGINAL_IMAGE_REGION=new RectangleImageRegion("<no region>",new PositionInRelativeCoord(0,0),new SizeInRelativeCoord(1,1)),window.customElements.define("image-display-control",ImageDisplayControl,{extends:"img"});var resizeObservers=[],hasActiveObservations=function(){return resizeObservers.some((function(e){return e.activeTargets.length>0}))},hasSkippedObservations=function(){return resizeObservers.some((function(e){return e.skippedTargets.length>0}))},msg="ResizeObserver loop completed with undelivered notifications.",deliverResizeLoopError=function(){var e;"function"==typeof ErrorEvent?e=new ErrorEvent("error",{message:msg}):((e=document.createEvent("Event")).initEvent("error",!1,!1),e.message=msg),window.dispatchEvent(e)},ResizeObserverBoxOptions;!function(e){e.BORDER_BOX="border-box",e.CONTENT_BOX="content-box",e.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"}(ResizeObserverBoxOptions||(ResizeObserverBoxOptions={}));var freeze=function(e){return Object.freeze(e)},ResizeObserverSize=function(e,t){this.inlineSize=e,this.blockSize=t,freeze(this)},DOMRectReadOnly=function(){function e(e,t,i,n){return this.x=e,this.y=t,this.width=i,this.height=n,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,freeze(this)}return e.prototype.toJSON=function(){var e=this;return{x:e.x,y:e.y,top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),isSVG=function(e){return e instanceof SVGElement&&"getBBox"in e},isHidden=function(e){if(isSVG(e)){var t=e.getBBox(),i=t.width,n=t.height;return!i&&!n}var s=e,r=s.offsetWidth,o=s.offsetHeight;return!(r||o||e.getClientRects().length)},isElement=function(e){var t;if(e instanceof Element)return!0;var i=null===(t=null==e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView;return!!(i&&e instanceof i.Element)},isReplacedElement=function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},global="undefined"!=typeof window?window:{},cache=new WeakMap,scrollRegexp=/auto|scroll/,verticalRegexp=/^tb|vertical/,IE=/msie|trident/i.test(global.navigator&&global.navigator.userAgent),parseDimension=function(e){return parseFloat(e||"0")},size=function(e,t,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=!1),new ResizeObserverSize((i?t:e)||0,(i?e:t)||0)},zeroBoxes=freeze({devicePixelContentBoxSize:size(),borderBoxSize:size(),contentBoxSize:size(),contentRect:new DOMRectReadOnly(0,0,0,0)}),calculateBoxSizes=function(e,t){if(void 0===t&&(t=!1),cache.has(e)&&!t)return cache.get(e);if(isHidden(e))return cache.set(e,zeroBoxes),zeroBoxes;var i=getComputedStyle(e),n=isSVG(e)&&e.ownerSVGElement&&e.getBBox(),s=!IE&&"border-box"===i.boxSizing,r=verticalRegexp.test(i.writingMode||""),o=!n&&scrollRegexp.test(i.overflowY||""),a=!n&&scrollRegexp.test(i.overflowX||""),l=n?0:parseDimension(i.paddingTop),h=n?0:parseDimension(i.paddingRight),g=n?0:parseDimension(i.paddingBottom),c=n?0:parseDimension(i.paddingLeft),d=n?0:parseDimension(i.borderTopWidth),u=n?0:parseDimension(i.borderRightWidth),f=n?0:parseDimension(i.borderBottomWidth),v=c+h,p=l+g,b=(n?0:parseDimension(i.borderLeftWidth))+u,_=d+f,m=a?e.offsetHeight-_-e.clientHeight:0,w=o?e.offsetWidth-b-e.clientWidth:0,R=s?v+b:0,y=s?p+_:0,z=n?n.width:parseDimension(i.width)-R-w,O=n?n.height:parseDimension(i.height)-y-m,S=z+v+w+b,x=O+p+m+_,C=freeze({devicePixelContentBoxSize:size(Math.round(z*devicePixelRatio),Math.round(O*devicePixelRatio),r),borderBoxSize:size(S,x,r),contentBoxSize:size(z,O,r),contentRect:new DOMRectReadOnly(c,l,z,O)});return cache.set(e,C),C},calculateBoxSize=function(e,t,i){var n=calculateBoxSizes(e,i),s=n.borderBoxSize,r=n.contentBoxSize,o=n.devicePixelContentBoxSize;switch(t){case ResizeObserverBoxOptions.DEVICE_PIXEL_CONTENT_BOX:return o;case ResizeObserverBoxOptions.BORDER_BOX:return s;default:return r}},ResizeObserverEntry=function(e){var t=calculateBoxSizes(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=freeze([t.borderBoxSize]),this.contentBoxSize=freeze([t.contentBoxSize]),this.devicePixelContentBoxSize=freeze([t.devicePixelContentBoxSize])},calculateDepthForNode=function(e){if(isHidden(e))return 1/0;for(var t=0,i=e.parentNode;i;)t+=1,i=i.parentNode;return t},broadcastActiveObservations=function(){var e=1/0,t=[];resizeObservers.forEach((function(i){if(0!==i.activeTargets.length){var n=[];i.activeTargets.forEach((function(t){var i=new ResizeObserverEntry(t.target),s=calculateDepthForNode(t.target);n.push(i),t.lastReportedSize=calculateBoxSize(t.target,t.observedBox),s<e&&(e=s)})),t.push((function(){i.callback.call(i.observer,n,i.observer)})),i.activeTargets.splice(0,i.activeTargets.length)}}));for(var i=0,n=t;i<n.length;i++){(0,n[i])()}return e},gatherActiveObservationsAtDepth=function(e){resizeObservers.forEach((function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach((function(i){i.isActive()&&(calculateDepthForNode(i.target)>e?t.activeTargets.push(i):t.skippedTargets.push(i))}))}))},process=function(){var e=0;for(gatherActiveObservationsAtDepth(e);hasActiveObservations();)e=broadcastActiveObservations(),gatherActiveObservationsAtDepth(e);return hasSkippedObservations()&&deliverResizeLoopError(),e>0},trigger,callbacks=[],notify=function(){return callbacks.splice(0).forEach((function(e){return e()}))},queueMicroTask=function(e){if(!trigger){var t=0,i=document.createTextNode("");new MutationObserver((function(){return notify()})).observe(i,{characterData:!0}),trigger=function(){i.textContent="".concat(t?t--:t++)}}callbacks.push(e),trigger()},queueResizeObserver=function(e){queueMicroTask((function(){requestAnimationFrame(e)}))},watching=0,isWatching=function(){return!!watching},CATCH_PERIOD=250,observerConfig={attributes:!0,characterData:!0,childList:!0,subtree:!0},events=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],time=function(e){return void 0===e&&(e=0),Date.now()+e},scheduled=!1,Scheduler=function(){function e(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){var t=this;if(void 0===e&&(e=CATCH_PERIOD),!scheduled){scheduled=!0;var i=time(e);queueResizeObserver((function(){var n=!1;try{n=process()}finally{if(scheduled=!1,e=i-time(),!isWatching())return;n?t.run(1e3):e>0?t.run(e):t.start()}}))}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,observerConfig)};document.body?t():global.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),events.forEach((function(t){return global.addEventListener(t,e.listener,!0)})))},e.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),events.forEach((function(t){return global.removeEventListener(t,e.listener,!0)})),this.stopped=!0)},e}(),scheduler=new Scheduler,updateCount=function(e){!watching&&e>0&&scheduler.start(),!(watching+=e)&&scheduler.stop()},skipNotifyOnElement=function(e){return!isSVG(e)&&!isReplacedElement(e)&&"inline"===getComputedStyle(e).display},ResizeObservation=function(){function e(e,t){this.target=e,this.observedBox=t||ResizeObserverBoxOptions.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var e=calculateBoxSize(this.target,this.observedBox,!0);return skipNotifyOnElement(this.target)&&(this.lastReportedSize=e),this.lastReportedSize.inlineSize!==e.inlineSize||this.lastReportedSize.blockSize!==e.blockSize},e}(),ResizeObserverDetail=function(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t},observerMap=new WeakMap,getObservationIndex=function(e,t){for(var i=0;i<e.length;i+=1)if(e[i].target===t)return i;return-1},ResizeObserverController=function(){function e(){}return e.connect=function(e,t){var i=new ResizeObserverDetail(e,t);observerMap.set(e,i)},e.observe=function(e,t,i){var n=observerMap.get(e),s=0===n.observationTargets.length;getObservationIndex(n.observationTargets,t)<0&&(s&&resizeObservers.push(n),n.observationTargets.push(new ResizeObservation(t,i&&i.box)),updateCount(1),scheduler.schedule())},e.unobserve=function(e,t){var i=observerMap.get(e),n=getObservationIndex(i.observationTargets,t),s=1===i.observationTargets.length;n>=0&&(s&&resizeObservers.splice(resizeObservers.indexOf(i),1),i.observationTargets.splice(n,1),updateCount(-1))},e.disconnect=function(e){var t=this,i=observerMap.get(e);i.observationTargets.slice().forEach((function(i){return t.unobserve(e,i.target)})),i.activeTargets.splice(0,i.activeTargets.length)},e}(),ResizeObserver$1=function(){function e(e){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof e)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");ResizeObserverController.connect(this,e)}return e.prototype.observe=function(e,t){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!isElement(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");ResizeObserverController.observe(this,e,t)},e.prototype.unobserve=function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!isElement(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");ResizeObserverController.unobserve(this,e)},e.prototype.disconnect=function(){ResizeObserverController.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}();window.ResizeObserver=window.ResizeObserver||ResizeObserver$1;
