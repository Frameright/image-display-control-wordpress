/*! (c) Andrea Giammarchi @webreflection ISC */
!function(){var e=function(e,t){var i=function(e){for(var t=0,i=e.length;t<i;t++)n(e[t])},n=function(e){var t=e.target,i=e.attributeName,n=e.oldValue;t.attributeChangedCallback(i,n,t.getAttribute(i))};return function(s,r){var o=s.constructor.observedAttributes;return o&&e(r).then((function(){new t(i).observe(s,{attributes:!0,attributeOldValue:!0,attributeFilter:o});for(var e=0,r=o.length;e<r;e++)s.hasAttribute(o[e])&&n({target:s,attributeName:o[e],oldValue:null})})),s}};function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function i(e,i){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,i){if(e){if("string"==typeof e)return t(e,i);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,i):void 0}}(e))||i&&e&&"number"==typeof e.length){n&&(e=n);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw o}}}}
/*! (c) Andrea Giammarchi - ISC */var n=!0,s=!1,r="querySelectorAll",o="querySelectorAll",a=self,l=a.document,h=a.Element,g=a.MutationObserver,u=a.Set,d=a.WeakMap,c=function(e){return o in e},f=[].filter,p=function(e){var t=new d,a=function(i,n){var s;if(n)for(var r,o=function(e){return e.matches||e.webkitMatchesSelector||e.msMatchesSelector}(i),a=0,l=v.length;a<l;a++)o.call(i,r=v[a])&&(t.has(i)||t.set(i,new u),(s=t.get(i)).has(r)||(s.add(r),e.handle(i,n,r)));else t.has(i)&&(s=t.get(i),t.delete(i),s.forEach((function(t){e.handle(i,n,t)})))},p=function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=0,n=e.length;i<n;i++)a(e[i],t)},v=e.query,_=e.root||l,b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:MutationObserver,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:["*"],l=function t(s,o,a,l,h,g){var u,d=i(s);try{for(d.s();!(u=d.n()).done;){var c=u.value;(g||r in c)&&(h?a.has(c)||(a.add(c),l.delete(c),e(c,h)):l.has(c)||(l.add(c),a.delete(c),e(c,h)),g||t(c[r](o),o,a,l,h,n))}}catch(e){d.e(e)}finally{d.f()}},h=new o((function(e){if(a.length){var t,r=a.join(","),o=new Set,h=new Set,g=i(e);try{for(g.s();!(t=g.n()).done;){var u=t.value,d=u.addedNodes,c=u.removedNodes;l(c,r,o,h,s,s),l(d,r,o,h,n,s)}}catch(e){g.e(e)}finally{g.f()}}})),g=h.observe;return(h.observe=function(e){return g.call(h,e,{subtree:n,childList:n})})(t),h}(a,_,g,v),m=h.prototype.attachShadow;return m&&(h.prototype.attachShadow=function(e){var t=m.call(this,e);return b.observe(t),t}),v.length&&p(_[o](v)),{drop:function(e){for(var i=0,n=e.length;i<n;i++)t.delete(e[i])},flush:function(){for(var e=b.takeRecords(),t=0,i=e.length;t<i;t++)p(f.call(e[t].removedNodes,c),!1),p(f.call(e[t].addedNodes,c),!0)},observer:b,parse:p}},v=self,_=v.document,b=v.Map,m=v.MutationObserver,w=v.Object,y=v.Set,R=v.WeakMap,S=v.Element,C=v.HTMLElement,x=v.Node,z=v.Error,O=v.TypeError,E=v.Reflect,T=w.defineProperty,I=w.keys,k=w.getOwnPropertyNames,A=w.setPrototypeOf,B=!self.customElements,F=function(e){for(var t=I(e),i=[],n=t.length,s=0;s<n;s++)i[s]=e[t[s]],delete e[t[s]];return function(){for(var s=0;s<n;s++)e[t[s]]=i[s]}};if(B){var D=function(){var e=this.constructor;if(!N.has(e))throw new O("Illegal constructor");var t=N.get(e);if(U)return q(U,t);var i=L.call(_,t);return q(A(i,e.prototype),t)},L=_.createElement,N=new b,P=new b,$=new b,M=new b,W=[],H=p({query:W,handle:function(e,t,i){var n=$.get(i);if(t&&!n.isPrototypeOf(e)){var s=F(e);U=A(e,n);try{new n.constructor}finally{U=null,s()}}var r="".concat(t?"":"dis","connectedCallback");r in n&&e[r]()}}).parse,U=null,G=function(e){if(!P.has(e)){var t,i=new Promise((function(e){t=e}));P.set(e,{$:i,_:t})}return P.get(e).$},q=e(G,m);T(self,"customElements",{configurable:!0,value:{define:function(e,t){if(M.has(e))throw new z('the name "'.concat(e,'" has already been used with this registry'));N.set(t,e),$.set(e,t.prototype),M.set(e,t),W.push(e),G(e).then((function(){H(_.querySelectorAll(e))})),P.get(e)._(t)},get:function(e){return M.get(e)},whenDefined:G}}),T(D.prototype=C.prototype,"constructor",{value:D}),T(self,"HTMLElement",{configurable:!0,value:D}),T(_,"createElement",{configurable:!0,value:function(e,t){var i=t&&t.is,n=i?M.get(i):M.get(e);return n?new n:L.call(_,e)}}),"isConnected"in x.prototype||T(x.prototype,"isConnected",{configurable:!0,get:function(){return!(this.ownerDocument.compareDocumentPosition(this)&this.DOCUMENT_POSITION_DISCONNECTED)}})}else if(B=!self.customElements.get("extends-li"))try{var V=function e(){return self.Reflect.construct(HTMLLIElement,[],e)};V.prototype=HTMLLIElement.prototype;var j="extends-li";self.customElements.define("extends-li",V,{extends:"li"}),B=_.createElement("li",{is:j}).outerHTML.indexOf(j)<0;var X=self.customElements,Z=X.get,J=X.whenDefined;T(self.customElements,"whenDefined",{configurable:!0,value:function(e){var t=this;return J.call(this,e).then((function(i){return i||Z.call(t,e)}))}})}catch(e){}if(B){var Y=function(e){var t=re.get(e);fe(t.querySelectorAll(this),e.isConnected)},K=self.customElements,Q=_.createElement,ee=K.define,te=K.get,ie=K.upgrade,ne=E||{construct:function(e){return e.call(this)}},se=ne.construct,re=new R,oe=new y,ae=new b,le=new b,he=new b,ge=new b,ue=[],de=[],ce=function(e){return ge.get(e)||te.call(K,e)},fe=p({query:de,handle:function(e,t,i){var n=he.get(i);if(t&&!n.isPrototypeOf(e)){var s=F(e);me=A(e,n);try{new n.constructor}finally{me=null,s()}}var r="".concat(t?"":"dis","connectedCallback");r in n&&e[r]()}}).parse,pe=p({query:ue,handle:function(e,t){re.has(e)&&(t?oe.add(e):oe.delete(e),de.length&&Y.call(de,e))}}).parse,ve=S.prototype.attachShadow;ve&&(S.prototype.attachShadow=function(e){var t=ve.call(this,e);return re.set(this,t),t});var _e=function(e){if(!le.has(e)){var t,i=new Promise((function(e){t=e}));le.set(e,{$:i,_:t})}return le.get(e).$},be=e(_e,m),me=null;k(self).filter((function(e){return/^HTML.*Element$/.test(e)})).forEach((function(e){var t=self[e];function i(){var e=this.constructor;if(!ae.has(e))throw new O("Illegal constructor");var i=ae.get(e),n=i.is,s=i.tag;if(n){if(me)return be(me,n);var r=Q.call(_,s);return r.setAttribute("is",n),be(A(r,e.prototype),n)}return se.call(this,t,[],e)}T(i.prototype=t.prototype,"constructor",{value:i}),T(self,e,{value:i})})),T(_,"createElement",{configurable:!0,value:function(e,t){var i=t&&t.is;if(i){var n=ge.get(i);if(n&&ae.get(n).tag===e)return new n}var s=Q.call(_,e);return i&&s.setAttribute("is",i),s}}),T(K,"get",{configurable:!0,value:ce}),T(K,"whenDefined",{configurable:!0,value:_e}),T(K,"upgrade",{configurable:!0,value:function(e){var t=e.getAttribute("is");if(t){var i=ge.get(t);if(i)return void be(A(e,i.prototype),t)}ie.call(K,e)}}),T(K,"define",{configurable:!0,value:function(e,t,i){if(ce(e))throw new z("'".concat(e,"' has already been defined as a custom element"));var n,s=i&&i.extends;ae.set(t,s?{is:e,tag:s}:{is:"",tag:e}),s?(n="".concat(s,'[is="').concat(e,'"]'),he.set(n,t.prototype),ge.set(e,t),de.push(n)):(ee.apply(K,arguments),ue.push(n=e)),_e(e).then((function(){s?(fe(_.querySelectorAll(n)),oe.forEach(Y,[n])):pe(_.querySelectorAll(n))})),le.get(e)._(t)}})}}();class e{constructor(t,i){this._id=t,this._level=e._toValue(i)}setLevel(t){this._level=e._toValue(t)}setId(e){this._id=e}debug(t){this._level>=e._DEBUG&&console.log(this._consoleText(t))}warn(t){this._level>=e._WARN&&console.warn(this._consoleText(t))}error(t){this._level>=e._ERROR&&console.error(this._consoleText(t))}static _toValue(t){const i=(t||"").toLowerCase();return"debug"===i||"trace"===i||"notice"===i?e._DEBUG:"info"===i?e._INFO:i.startsWith("warn")?e._WARN:i.startsWith("err")?e._ERROR:"fatal"===i?e._FATAL:e._OFF}_consoleText(e){return this._id?`[idc:${this._id}] ${e}`:`[idc] ${e}`}}e._OFF=0,e._FATAL=1,e._ERROR=2,e._WARN=3,e._INFO=4,e._DEBUG=5;class t{constructor(e,t){this.x=e,this.y=t}getRelativeCoord(e){return e.isUnknown()?new i:new i(this.x/e.getSafeWidth(),this.y/e.getSafeHeight())}toString(){return`{x=${this.x.toFixed(3)}px, y=${this.y.toFixed(3)}px}`}}class i{constructor(e,t){this._x=Math.max(Math.min(null!=e?e:0,1),0),this._y=Math.max(Math.min(null!=t?t:0,1),0)}getPositionInPixels(e){let i=0,n=0;return e.isUnknown()||(i=e.getWidth(),n=e.getHeight()),new t(this._x*i,this._y*n)}toString(){return`{x=${this._x.toFixed(3)}, y=${this._y.toFixed(3)}}`}}class n{constructor(e,t){this._width=Math.max(Math.min(null!=e?e:0,1),0),this._height=Math.max(Math.min(null!=t?t:0,1),0)}getSizeInPixels(e){let t=0,i=0;return e.isUnknown()||(t=e.getWidth(),i=e.getHeight()),new s(this._width*t,this._height*i)}toString(){return`{width=${this._width.toFixed(3)}, height=${this._height.toFixed(3)}}`}}class s{constructor(e,t){this._unknown=!0,this._width=0,this._height=0,null!=e&&null!=t&&(this._width=Math.max(e,0),this._height=Math.max(t,0),this._unknown=!1)}getWidth(){return this._width}getHeight(){return this._height}getSafeWidth(){return Math.max(this._width,1)}getSafeHeight(){return Math.max(this._height,1)}getSafeRatio(){return this.getSafeWidth()/this.getSafeHeight()}getScaled(e){if(this.isUnknown())return new s;const t=this._width*e,i=this._height*e;return new s(t,i)}isUnknown(){return this._unknown}setIfDifferent(e){return!this.equals(e)&&(this._unknown=e.isUnknown(),this._width=e.getWidth(),this._height=e.getHeight(),!0)}ratioDiffFactor(e){const t=this.getSafeRatio(),i=e.getSafeRatio();return t>=i?t/i:i/t}getRelativeCoord(e){return e.isUnknown()?new n:new n(this._width/e.getSafeWidth(),this._height/e.getSafeHeight())}toString(){return`{width=${this._width.toFixed(3)}px, height=${this._height.toFixed(3)}px}`}equals(e){return this._width===e.getWidth()&&this._height===e.getHeight()}}class r{static getTransformedImageSize(e,t){return e.getScaled(t.factor)}constructor(e,t,s){this.id=null!=e?e:"",this.position=null!=t?t:new i,this.size=null!=s?s:new n,this._unknown=!t||!s}setFields(e,r){var o,a;const l=e.shape?e.shape.toLowerCase():"rectangle";if("rectangle"!==l)return r.debug(`Region ${e.id} has unknown shape ${l}, skipping.`),void(this._unknown=!0);let h=null===(o=e.unit)||void 0===o?void 0:o.toLowerCase();if(h||(e.imageWidth&&e.imageHeight?h="pixel":e.imageWidth||e.imageHeight||(h="relative")),"relative"!==h&&"pixel"!==h)return r.debug(`Region ${e.id} has unknown unit ${h}, skipping.`),void(this._unknown=!0);let g=new s;if("pixel"===h){if(null==e.imageWidth||null==e.imageHeight)return r.warn(`Region ${e.id} has missing imageWidth or imageHeight, skipping.`),void(this._unknown=!0);g=new s(parseFloat(`${e.imageWidth}`),parseFloat(`${e.imageHeight}`))}if(null==e.x||null==e.y||null==e.width||null==e.height)return r.warn(`Region ${e.id} has missing x, y, width or height, skipping.`),void(this._unknown=!0);const u=parseFloat(`${e.x}`),d=parseFloat(`${e.y}`),c=parseFloat(`${e.width}`),f=parseFloat(`${e.height}`);return Number.isNaN(u)||Number.isNaN(d)||Number.isNaN(c)||Number.isNaN(f)?(r.warn(`Region ${e.id} has non-numeric x, y, width or height, skipping.`),void(this._unknown=!0)):u<0||d<0||c<=0||f<=0?(r.warn(`Region ${e.id} has negative/zero x, y, width or height, skipping.`),void(this._unknown=!0)):("relative"===h?(this.position=new i(u,d),this.size=new n(c,f)):(this.position=new t(u,d).getRelativeCoord(g),this.size=new s(c,f).getRelativeCoord(g)),this.id=null!==(a=e.id)&&void 0!==a?a:window.crypto.randomUUID(),void(this._unknown=!1))}isUnknown(){return this._unknown}getTransformation(e,i,n){const r=this.position.getPositionInPixels(i),o=this.size.getSizeInPixels(i),a=o.getSafeWidth(),l=o.getSafeHeight(),h=e.getSafeWidth(),g=e.getSafeHeight(),u=i.getWidth(),d=i.getHeight(),c=u-a-r.x,f=d-l-r.y;let p=0,v=0,_=1;if(e.getSafeRatio()<o.getSafeRatio()){_=h/a,v=(g/_-l)/2;(v-r.y>0||v-f>0)&&(v=Math.min(r.y,f),_=g/(2*v+l),p=(h/_-a)/2)}else{_=g/l,p=(h/_-a)/2;(p-r.x>0||p-c>0)&&(p=Math.min(r.x,c),_=h/(2*p+a),v=(g/_-l)/2)}const b=new t(r.x-p,r.y-v);return{origin:b,factor:_,insetClipFromTopLeft:new s(b.x,b.y),insetClipFromBottomRight:new s(c-p+n.getWidth(),f-v+n.getHeight())}}getBoundingBox(e,i,n){const s=new t(-n.origin.x*n.factor,-n.origin.y*n.factor),o=r.getTransformedImageSize(i,n),a=this.position.getPositionInPixels(o);return{position:new t(a.x+s.x,a.y+s.y),size:this.size.getSizeInPixels(o)}}}class o extends HTMLImageElement{constructor(){super(...arguments),this._rectangleImageRegions=[],this._sizeObserver=null,this._elementSize=new s,this._fittedImageSize=new s,this._fittedImageBottomRightMargin=new s,this._parentElement=null,this._parentCssContainToRestore=null,this._parentCssOverflowToRestore=null,this._sizesAttributeToRestore=null,this._sizesAttributeDebounceTimer=null,this._sizesAttributeLastSet=null,this._cssBorderToRestore=null,this._cssPaddingToRestore=null,this._logger=new e(this.id,this.dataset.loglevel),this._browserFeatures={cssInset:!1,resizeObserver:!1,cssContain:!1},this._debugRegionOverlayContainer=null,this._debugRegionOverlays=new Map,this._debugRegionOverlayStyles=["5px solid rgba(240, 69, 141, 0.7)","5px solid rgba(127, 15, 130, 0.7)","5px solid rgba(48, 0, 150, 0.7)"]}static get observedAttributes(){return["id","src","srcset","data-loglevel","data-disabled","data-image-regions","data-image-region-id","data-avoid-no-region","data-debug-draw-regions","data-css-contain-fallback"]}connectedCallback(){this._logger.debug("Connected"),this._registerImageLoadedLateCallback(),this._behaviorChanged()}disconnectedCallback(){this._logger.debug("Disconnected"),this._unregisterImageLoadedLateCallback(),this._restoreOriginalParentCssContainment()}attributeChangedCallback(e){switch(e){case"id":this._logger.setId(this.id);break;case"src":case"srcset":this._isDisabled()||(this._registerImageLoadedLateCallback(),this._panAndZoomToBestRegion());break;case"data-loglevel":this._logger.setLevel(this.dataset.loglevel);break;case"data-disabled":case"data-debug-draw-regions":case"data-css-contain-fallback":this._behaviorChanged();break;case"data-image-regions":this._populateRectangleImageRegions(),this._isDisabled()||this._panAndZoomToBestRegion();break;case"data-image-region-id":case"data-avoid-no-region":this._isDisabled()||this._panAndZoomToBestRegion();break;default:this._logger.warn(`Unexpected attribute mutation: ${e}`)}}_behaviorChanged(){this._populateBrowserFeatures();const e="on"===(this.dataset.debugDrawRegions||"off");this._isDisabled()?(this._unregisterImageLoadedLateCallback(),this._logger.debug("Disabled"),this._sizeObserver&&(this._sizeObserver.unobserve(this),this._sizeObserver=null),this._setDebounceSizesAttribute(),this._restoreOriginalBorderAndPadding(),this._removeDebugRegionOverlays(),this._setCssToMiddleCropOriginalImage(),this._restoreOriginalParentCssContainment()):(this._logger.debug("Enabled"),this._adaptParentCssContainment(),e?this._recreateDebugRegionOverlays():this._removeDebugRegionOverlays(),this._panAndZoomToBestRegion(),this._sizeObserver||(this._sizeObserver=new ResizeObserver(this._resizeCallback.bind(this)),this._sizeObserver.observe(this)))}_resizeCallback(e){if(this._isDisabled())return void this._logger.warn("Component disabled, spurious call to _resizeCallback()");const t=e.pop();if(!t)return void this._logger.warn("No ResizeObserverEntry, spurious call to _resizeCallback()");if(t.target!==this)return void this._logger.warn("Unexpected ResizeObserverEntry target");let i=new s;i=t.contentBoxSize?new s(t.contentBoxSize[0].inlineSize,t.contentBoxSize[0].blockSize):new s(t.contentRect.width,t.contentRect.height);this._elementSize.setIfDifferent(i)&&(this._logger.debug(`Element size: ${this._elementSize}`),this._populateFittedImageSize(),this._panAndZoomToBestRegion())}_imageLoadedLateCallback(){this._unregisterImageLoadedLateCallback(),this._logger.debug("Image loaded late"),this._populateFittedImageSize(),this._panAndZoomToBestRegion()}_registerImageLoadedLateCallback(){this.addEventListener("load",this._imageLoadedLateCallback)}_unregisterImageLoadedLateCallback(){this.removeEventListener("load",this._imageLoadedLateCallback)}_populateRectangleImageRegions(){this._logger.debug("Populating rectangle image regions..."),this._rectangleImageRegions=[];let e=[],t=!1;try{e=JSON.parse(this.dataset.imageRegions||"[]")}catch(e){t=!0}t||(t=!Array.isArray(e)),t&&(this._logger.warn("Invalid 'data-image-regions' attribute"),e=[]),e.forEach((e=>{const t=new r;t.setFields(e,this._logger),t.isUnknown()||(this._logger.debug(`Rectangle region found: id=${t.id}, position=${t.position}, size=${t.size}`),this._rectangleImageRegions.push(t))})),this._rectangleImageRegions.length||this._logger.debug("No rectangle image region found")}_populateFittedImageSize(){if(this.naturalWidth<=0&&this.naturalHeight<=0)return void this._logger.debug("Natural image size unknown, deferring.");const e=new s(this.naturalWidth,this.naturalHeight);let t=1;t=this._elementSize.getSafeRatio()<e.getSafeRatio()?this._elementSize.getSafeWidth()/e.getSafeWidth():this._elementSize.getSafeHeight()/e.getSafeHeight(),this._fittedImageSize=new s(this.naturalWidth*t,this.naturalHeight*t),this._fittedImageBottomRightMargin=new s(this._elementSize.getWidth()-this._fittedImageSize.getWidth(),this._elementSize.getHeight()-this._fittedImageSize.getHeight()),this._logger.debug(`Fitted image size: ${this._fittedImageSize}`),this._logger.debug(`Fitted image margin: ${this._fittedImageBottomRightMargin}`)}_panAndZoomToBestRegion(){if(this._logger.debug("Panning and zooming to best region..."),this._fittedImageSize.isUnknown())return void this._logger.debug("Fitted image size unknown, deferring.");let e=null;if(this.dataset.imageRegionId&&(e=this.dataset.imageRegionId===o._ORIGINAL_IMAGE_REGION.id?o._ORIGINAL_IMAGE_REGION:this._rectangleImageRegions.find((e=>e.id===this.dataset.imageRegionId))),e||(e=this._findBestRegion()),o._ORIGINAL_IMAGE_REGION.id!==e.id||this._debugRegionOverlayContainer){null===this._cssBorderToRestore&&(this._cssBorderToRestore=this.style.border,this.style.border="none"),null===this._cssPaddingToRestore&&(this._cssPaddingToRestore=this.style.padding,this.style.padding="0");const t=e.getTransformation(this._elementSize,this._fittedImageSize,this._fittedImageBottomRightMargin);if(this._setCssToPanAndZoomToRegion(t),this._debugRegionOverlayContainer&&this._drawDebugRegionOverlays(t),this.srcset.length>0&&this.sizes.length>0){const e=r.getTransformedImageSize(this._fittedImageSize,t).getWidth();this._setDebounceSizesAttribute(e)}}else this._setDebounceSizesAttribute(),this._restoreOriginalBorderAndPadding(),this._setCssToMiddleCropOriginalImage()}_findBestRegion(){let e=o._ORIGINAL_IMAGE_REGION,t=this._elementSize.ratioDiffFactor(this._fittedImageSize);return this._logger.debug(`Element ratio: ${this._elementSize.getSafeRatio().toFixed(3)}`),this._logger.debug(`Original image ratio: ${this._fittedImageSize.getSafeRatio().toFixed(3)}`),this.dataset.avoidNoRegion&&"off"===this.dataset.avoidNoRegion||(t=999),t>1.1&&this._rectangleImageRegions.forEach((i=>{const n=i.size.getSizeInPixels(this._fittedImageSize);this._logger.debug(`${i.id} region ratio: ${n.getSafeRatio().toFixed(3)}`);const s=this._elementSize.ratioDiffFactor(n);s<t&&(t=s,e=i)})),this._logger.debug(`Selected region: ${e.id}`),e}_adaptParentCssContainment(){const e=this._currentCssContainmentStrategy();"none"!==e?(this._parentElement=this.parentElement,this._parentElement&&("contain"===e?("paint"!==this._parentElement.style.contain&&"layout"!==this._parentElement.style.contain&&"content"!==this._parentElement.style.contain&&(null===this._parentCssContainToRestore&&(this._parentCssContainToRestore=this._parentElement.style.contain),this._parentElement.style.contain="paint"),this._restoreOriginalParentCssOverflow()):"overflow"===e&&("hidden"!==this._parentElement.style.overflow&&"clip"!==this._parentElement.style.overflow&&(null===this._parentCssOverflowToRestore&&(this._parentCssOverflowToRestore=this._parentElement.style.overflow),this._parentElement.style.overflow="hidden"),this._restoreOriginalParentCssContain()))):this._restoreOriginalParentCssContainment()}_restoreOriginalParentCssContainment(){this._restoreOriginalParentCssContain(),this._restoreOriginalParentCssOverflow()}_restoreOriginalParentCssContain(){this._parentElement&&null!==this._parentCssContainToRestore&&(this._parentElement.style.contain=this._parentCssContainToRestore,this._parentCssContainToRestore=null)}_restoreOriginalParentCssOverflow(){this._parentElement&&null!==this._parentCssOverflowToRestore&&(this._parentElement.style.overflow=this._parentCssOverflowToRestore,this._parentCssOverflowToRestore=null)}_setDebounceSizesAttribute(e){this._unregisterImageLoadedLateCallback(),null!==this._sizesAttributeDebounceTimer&&clearTimeout(this._sizesAttributeDebounceTimer);this._sizesAttributeDebounceTimer=void 0!==e?window.setTimeout((()=>{this._sizesAttributeDebounceTimer=null,null===this._sizesAttributeToRestore&&(this._sizesAttributeToRestore=this.sizes),(null===this._sizesAttributeLastSet||this._sizesAttributeLastSet<e)&&(this.sizes=`${Math.ceil(e)}px`,this._sizesAttributeLastSet=e)}),200):window.setTimeout((()=>{this._sizesAttributeDebounceTimer=null,null!==this._sizesAttributeToRestore&&(this.sizes=this._sizesAttributeToRestore,this._sizesAttributeToRestore=null),this._sizesAttributeLastSet=null}),200)}_restoreOriginalBorderAndPadding(){null!==this._cssBorderToRestore&&(this.style.border=this._cssBorderToRestore,this._cssBorderToRestore=null),null!==this._cssPaddingToRestore&&(this.style.padding=this._cssPaddingToRestore,this._cssPaddingToRestore=null)}_setCssToMiddleCropOriginalImage(){this.style.objectFit="cover",this.style.objectPosition="center",this.style.transformOrigin="0 0",this.style.transform="none",this.style.clipPath="none"}_setCssToPanAndZoomToRegion(e){this.style.objectFit="contain",this.style.objectPosition="top left",this.style.transformOrigin=`${e.origin.x.toFixed(3)}px ${e.origin.y.toFixed(3)}px`,this.style.transform=`translate(${-e.origin.x.toFixed(3)}px, ${-e.origin.y.toFixed(3)}px) scale(${e.factor.toFixed(3)})`,this.style.clipPath=`inset(${e.insetClipFromTopLeft.getHeight()}px ${e.insetClipFromBottomRight.getWidth()}px ${e.insetClipFromBottomRight.getHeight()}px ${e.insetClipFromTopLeft.getWidth()}px)`}_recreateDebugRegionOverlays(){var e;this._debugRegionOverlayContainer&&this._removeDebugRegionOverlays(),this._debugRegionOverlayContainer=document.createElement("div"),this._debugRegionOverlayContainer.style.position="absolute",null===(e=this._parentElement)||void 0===e||e.insertBefore(this._debugRegionOverlayContainer,this)}_removeDebugRegionOverlays(){var e;this._debugRegionOverlayContainer&&(null===(e=this._parentElement)||void 0===e||e.removeChild(this._debugRegionOverlayContainer),this._debugRegionOverlayContainer=null),this._debugRegionOverlays.clear()}_drawDebugRegionOverlays(e){this._rectangleImageRegions.forEach((t=>{this._drawDebugRegionOverlay(t,e)}))}_drawDebugRegionOverlay(e,t){var i;let n=this._debugRegionOverlays.get(e.id);n||(n=document.createElement("div"),n.style.position="absolute",n.style.boxSizing="border-box",n.style.border=this._pickNextOvelayStyle(),n.style.zIndex="999",null===(i=this._debugRegionOverlayContainer)||void 0===i||i.appendChild(n),this._debugRegionOverlays.set(e.id,n));const s=e.getBoundingBox(this._elementSize,this._fittedImageSize,t);n.style.left=`${s.position.x}px`,n.style.top=`${s.position.y}px`,n.style.width=`${s.size.getWidth()}px`,n.style.height=`${s.size.getHeight()}px`}_pickNextOvelayStyle(){const e=this._debugRegionOverlayStyles.shift()||"5px solid rgba(255, 0, 0, 0.7)";return this._debugRegionOverlayStyles.push(e),e}_populateBrowserFeatures(){const e=CSS.supports("clip-path: inset(5px)");e||this._logger.error("CSS `clip-path: inset()` is not supported. Disabling the web component");const t="undefined"!=typeof ResizeObserver;t||this._logger.error("ResizeObserver is not supported. Disabling the web component. Consider using a polyfill like  https://github.com/juggle/resize-observer");const i=CSS.supports("contain: paint");i||this.dataset.cssContainFallback||this._logger.warn("CSS containment is not supported. Consider using the `css-contain-fallback=` attribute"),this._browserFeatures={cssInset:e,resizeObserver:t,cssContain:i}}_cssContainFallbackStrategy(){return"disable-containment"===this.dataset.cssContainFallback||"overflow-hidden"===this.dataset.cssContainFallback||"force"===this.dataset.cssContainFallback?this.dataset.cssContainFallback:"disable-component"}_isDisabled(){return"all"===this.dataset.disabled||!this._browserFeatures.cssInset||!this._browserFeatures.resizeObserver||this._isCssContainUnsupportedOrDisabled()&&"disable-component"===this._cssContainFallbackStrategy()}_isCssContainUnsupportedOrDisabled(){return!this._browserFeatures.cssContain||"css-contain"===this.dataset.disabled}_currentCssContainmentStrategy(){if(this._isDisabled())return"none";if(!this._isCssContainUnsupportedOrDisabled())return"contain";const e=this._cssContainFallbackStrategy();return"overflow-hidden"===e?"overflow":"disable-containment"===e?"none":"contain"}}o._ORIGINAL_IMAGE_REGION=new r("<no region>",new i(0,0),new n(1,1)),window.customElements.define("image-display-control",o,{extends:"img"});var a,l=[],h="ResizeObserver loop completed with undelivered notifications.";!function(e){e.BORDER_BOX="border-box",e.CONTENT_BOX="content-box",e.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"}(a||(a={}));var g,u=function(e){return Object.freeze(e)},d=function(e,t){this.inlineSize=e,this.blockSize=t,u(this)},c=function(){function e(e,t,i,n){return this.x=e,this.y=t,this.width=i,this.height=n,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,u(this)}return e.prototype.toJSON=function(){var e=this;return{x:e.x,y:e.y,top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),f=function(e){return e instanceof SVGElement&&"getBBox"in e},p=function(e){if(f(e)){var t=e.getBBox(),i=t.width,n=t.height;return!i&&!n}var s=e,r=s.offsetWidth,o=s.offsetHeight;return!(r||o||e.getClientRects().length)},v=function(e){var t;if(e instanceof Element)return!0;var i=null===(t=null==e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView;return!!(i&&e instanceof i.Element)},_="undefined"!=typeof window?window:{},b=new WeakMap,m=/auto|scroll/,w=/^tb|vertical/,y=/msie|trident/i.test(_.navigator&&_.navigator.userAgent),R=function(e){return parseFloat(e||"0")},S=function(e,t,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=!1),new d((i?t:e)||0,(i?e:t)||0)},C=u({devicePixelContentBoxSize:S(),borderBoxSize:S(),contentBoxSize:S(),contentRect:new c(0,0,0,0)}),x=function(e,t){if(void 0===t&&(t=!1),b.has(e)&&!t)return b.get(e);if(p(e))return b.set(e,C),C;var i=getComputedStyle(e),n=f(e)&&e.ownerSVGElement&&e.getBBox(),s=!y&&"border-box"===i.boxSizing,r=w.test(i.writingMode||""),o=!n&&m.test(i.overflowY||""),a=!n&&m.test(i.overflowX||""),l=n?0:R(i.paddingTop),h=n?0:R(i.paddingRight),g=n?0:R(i.paddingBottom),d=n?0:R(i.paddingLeft),v=n?0:R(i.borderTopWidth),_=n?0:R(i.borderRightWidth),x=n?0:R(i.borderBottomWidth),z=d+h,O=l+g,E=(n?0:R(i.borderLeftWidth))+_,T=v+x,I=a?e.offsetHeight-T-e.clientHeight:0,k=o?e.offsetWidth-E-e.clientWidth:0,A=s?z+E:0,B=s?O+T:0,F=n?n.width:R(i.width)-A-k,D=n?n.height:R(i.height)-B-I,L=F+z+k+E,N=D+O+I+T,P=u({devicePixelContentBoxSize:S(Math.round(F*devicePixelRatio),Math.round(D*devicePixelRatio),r),borderBoxSize:S(L,N,r),contentBoxSize:S(F,D,r),contentRect:new c(d,l,F,D)});return b.set(e,P),P},z=function(e,t,i){var n=x(e,i),s=n.borderBoxSize,r=n.contentBoxSize,o=n.devicePixelContentBoxSize;switch(t){case a.DEVICE_PIXEL_CONTENT_BOX:return o;case a.BORDER_BOX:return s;default:return r}},O=function(e){var t=x(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=u([t.borderBoxSize]),this.contentBoxSize=u([t.contentBoxSize]),this.devicePixelContentBoxSize=u([t.devicePixelContentBoxSize])},E=function(e){if(p(e))return 1/0;for(var t=0,i=e.parentNode;i;)t+=1,i=i.parentNode;return t},T=function(){var e=1/0,t=[];l.forEach((function(i){if(0!==i.activeTargets.length){var n=[];i.activeTargets.forEach((function(t){var i=new O(t.target),s=E(t.target);n.push(i),t.lastReportedSize=z(t.target,t.observedBox),s<e&&(e=s)})),t.push((function(){i.callback.call(i.observer,n,i.observer)})),i.activeTargets.splice(0,i.activeTargets.length)}}));for(var i=0,n=t;i<n.length;i++){(0,n[i])()}return e},I=function(e){l.forEach((function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach((function(i){i.isActive()&&(E(i.target)>e?t.activeTargets.push(i):t.skippedTargets.push(i))}))}))},k=function(){var e,t=0;for(I(t);l.some((function(e){return e.activeTargets.length>0}));)t=T(),I(t);return l.some((function(e){return e.skippedTargets.length>0}))&&("function"==typeof ErrorEvent?e=new ErrorEvent("error",{message:h}):((e=document.createEvent("Event")).initEvent("error",!1,!1),e.message=h),window.dispatchEvent(e)),t>0},A=[],B=function(e){if(!g){var t=0,i=document.createTextNode("");new MutationObserver((function(){return A.splice(0).forEach((function(e){return e()}))})).observe(i,{characterData:!0}),g=function(){i.textContent="".concat(t?t--:t++)}}A.push(e),g()},F=0,D={attributes:!0,characterData:!0,childList:!0,subtree:!0},L=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],N=function(e){return void 0===e&&(e=0),Date.now()+e},P=!1,$=new(function(){function e(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){var t=this;if(void 0===e&&(e=250),!P){P=!0;var i,n=N(e);i=function(){var i=!1;try{i=k()}finally{if(P=!1,e=n-N(),!F)return;i?t.run(1e3):e>0?t.run(e):t.start()}},B((function(){requestAnimationFrame(i)}))}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,D)};document.body?t():_.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),L.forEach((function(t){return _.addEventListener(t,e.listener,!0)})))},e.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),L.forEach((function(t){return _.removeEventListener(t,e.listener,!0)})),this.stopped=!0)},e}()),M=function(e){!F&&e>0&&$.start(),!(F+=e)&&$.stop()},W=function(){function e(e,t){this.target=e,this.observedBox=t||a.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var e,t=z(this.target,this.observedBox,!0);return e=this.target,f(e)||function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(e)||"inline"!==getComputedStyle(e).display||(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},e}(),H=function(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t},U=new WeakMap,G=function(e,t){for(var i=0;i<e.length;i+=1)if(e[i].target===t)return i;return-1},q=function(){function e(){}return e.connect=function(e,t){var i=new H(e,t);U.set(e,i)},e.observe=function(e,t,i){var n=U.get(e),s=0===n.observationTargets.length;G(n.observationTargets,t)<0&&(s&&l.push(n),n.observationTargets.push(new W(t,i&&i.box)),M(1),$.schedule())},e.unobserve=function(e,t){var i=U.get(e),n=G(i.observationTargets,t),s=1===i.observationTargets.length;n>=0&&(s&&l.splice(l.indexOf(i),1),i.observationTargets.splice(n,1),M(-1))},e.disconnect=function(e){var t=this,i=U.get(e);i.observationTargets.slice().forEach((function(i){return t.unobserve(e,i.target)})),i.activeTargets.splice(0,i.activeTargets.length)},e}(),V=function(){function e(e){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof e)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");q.connect(this,e)}return e.prototype.observe=function(e,t){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!v(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");q.observe(this,e,t)},e.prototype.unobserve=function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!v(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");q.unobserve(this,e)},e.prototype.disconnect=function(){q.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}();window.ResizeObserver=window.ResizeObserver||V;
